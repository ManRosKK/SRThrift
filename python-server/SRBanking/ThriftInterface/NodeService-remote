#!/usr/bin/env python
#
# Autogenerated by Thrift Compiler (0.9.1)
#
# DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
#
#  options string: py
#

import sys
import pprint
from urlparse import urlparse
from thrift.transport import TTransport
from thrift.transport import TSocket
from thrift.transport import THttpClient
from thrift.protocol import TBinaryProtocol

from SRBanking.ThriftInterface import NodeService
from SRBanking.ThriftInterface.ttypes import *

if len(sys.argv) <= 1 or sys.argv[1] == '--help':
  print ''
  print 'Usage: ' + sys.argv[0] + ' [-h host[:port]] [-u url] [-f[ramed]] function [arg1 [arg2...]]'
  print ''
  print 'Functions:'
  print '  void MakeTransfer(NodeID receiver, AccountBalanceType value)'
  print '  AccountBalanceType GetAccountBalance()'
  print '  void Ping()'
  print '  void PingSwarm(NodeID leader, TransferID transfer)'
  print '  void UpdateSwarmMembers(Swarm swarm)'
  print '  void AddToSwarm(Swarm swarm)'
  print '  void DelSwarm(Swarm swarm)'
  print '  Swarm GetSwarm(TransferID transfer)'
  print '  bool ElectSwarmLeader(NodeID cadidate, TransferID Transfer)'
  print '  void ElectionEndedSwarm(Swarm swarm)'
  print '  void DeliverTransfer(TransferData transfer)'
  print '   GetSwarmList()'
  print '  void startSwarmElection(TransferID transfer)'
  print '   GetTransfers()'
  print '  void stop()'
  print ''
  sys.exit(0)

pp = pprint.PrettyPrinter(indent = 2)
host = 'localhost'
port = 9090
uri = ''
framed = False
http = False
argi = 1

if sys.argv[argi] == '-h':
  parts = sys.argv[argi+1].split(':')
  host = parts[0]
  if len(parts) > 1:
    port = int(parts[1])
  argi += 2

if sys.argv[argi] == '-u':
  url = urlparse(sys.argv[argi+1])
  parts = url[1].split(':')
  host = parts[0]
  if len(parts) > 1:
    port = int(parts[1])
  else:
    port = 80
  uri = url[2]
  if url[4]:
    uri += '?%s' % url[4]
  http = True
  argi += 2

if sys.argv[argi] == '-f' or sys.argv[argi] == '-framed':
  framed = True
  argi += 1

cmd = sys.argv[argi]
args = sys.argv[argi+1:]

if http:
  transport = THttpClient.THttpClient(host, port, uri)
else:
  socket = TSocket.TSocket(host, port)
  if framed:
    transport = TTransport.TFramedTransport(socket)
  else:
    transport = TTransport.TBufferedTransport(socket)
protocol = TBinaryProtocol.TBinaryProtocol(transport)
client = NodeService.Client(protocol)
transport.open()

if cmd == 'MakeTransfer':
  if len(args) != 2:
    print 'MakeTransfer requires 2 args'
    sys.exit(1)
  pp.pprint(client.MakeTransfer(eval(args[0]),eval(args[1]),))

elif cmd == 'GetAccountBalance':
  if len(args) != 0:
    print 'GetAccountBalance requires 0 args'
    sys.exit(1)
  pp.pprint(client.GetAccountBalance())

elif cmd == 'Ping':
  if len(args) != 0:
    print 'Ping requires 0 args'
    sys.exit(1)
  pp.pprint(client.Ping())

elif cmd == 'PingSwarm':
  if len(args) != 2:
    print 'PingSwarm requires 2 args'
    sys.exit(1)
  pp.pprint(client.PingSwarm(eval(args[0]),eval(args[1]),))

elif cmd == 'UpdateSwarmMembers':
  if len(args) != 1:
    print 'UpdateSwarmMembers requires 1 args'
    sys.exit(1)
  pp.pprint(client.UpdateSwarmMembers(eval(args[0]),))

elif cmd == 'AddToSwarm':
  if len(args) != 1:
    print 'AddToSwarm requires 1 args'
    sys.exit(1)
  pp.pprint(client.AddToSwarm(eval(args[0]),))

elif cmd == 'DelSwarm':
  if len(args) != 1:
    print 'DelSwarm requires 1 args'
    sys.exit(1)
  pp.pprint(client.DelSwarm(eval(args[0]),))

elif cmd == 'GetSwarm':
  if len(args) != 1:
    print 'GetSwarm requires 1 args'
    sys.exit(1)
  pp.pprint(client.GetSwarm(eval(args[0]),))

elif cmd == 'ElectSwarmLeader':
  if len(args) != 2:
    print 'ElectSwarmLeader requires 2 args'
    sys.exit(1)
  pp.pprint(client.ElectSwarmLeader(eval(args[0]),eval(args[1]),))

elif cmd == 'ElectionEndedSwarm':
  if len(args) != 1:
    print 'ElectionEndedSwarm requires 1 args'
    sys.exit(1)
  pp.pprint(client.ElectionEndedSwarm(eval(args[0]),))

elif cmd == 'DeliverTransfer':
  if len(args) != 1:
    print 'DeliverTransfer requires 1 args'
    sys.exit(1)
  pp.pprint(client.DeliverTransfer(eval(args[0]),))

elif cmd == 'GetSwarmList':
  if len(args) != 0:
    print 'GetSwarmList requires 0 args'
    sys.exit(1)
  pp.pprint(client.GetSwarmList())

elif cmd == 'startSwarmElection':
  if len(args) != 1:
    print 'startSwarmElection requires 1 args'
    sys.exit(1)
  pp.pprint(client.startSwarmElection(eval(args[0]),))

elif cmd == 'GetTransfers':
  if len(args) != 0:
    print 'GetTransfers requires 0 args'
    sys.exit(1)
  pp.pprint(client.GetTransfers())

elif cmd == 'stop':
  if len(args) != 0:
    print 'stop requires 0 args'
    sys.exit(1)
  pp.pprint(client.stop())

else:
  print 'Unrecognized method %s' % cmd
  sys.exit(1)

transport.close()
